     1 00000000                                 ;hello-os
     2 00000000                                 ;TAB=4
     3 00000000                                 
     4  = 00000009                              CYLS EQU 9
     5 00000000                                 
     6                                              ORG 0x7c00
     7 00007C00                                 
     8 00007C00 EB 56                               JMP entry
     9 00007C02 90                                  DB  0x90
    10 00007C03                                 
    11 00007C03 48 41 52 49 42 4F 54 45             DB  "HARIBOTE"                      ;启动区的名称可以是任意的字符串（8字节）
    12 00007C0B 0200                                DW  512                             ;每个扇区（sector）的大小（必须为512字节）
    13 00007C0D 01                                  DB  1                               ;簇（cluster）的大小（必须为1个扇区）
    14 00007C0E 0001                                DW  1                               ;FAT的起始位置（一般从第一个扇区开始）
    15 00007C10 02                                  DB  2                               ;FAT的个数（必须为2）
    16 00007C11 00E0                                DW  224                             ;根目录的大小（一般设成224项）
    17 00007C13 0B40                                DW  2880                            ;该磁盘的大小（必须是2880扇区）
    18 00007C15 F0                                  DB  0XF0                            ;磁盘的种类（必须是0XF0）
    19 00007C16 0009                                DW  9                               ;FAT的长度（必须是9扇区）
    20 00007C18 0012                                DW  18                              ;1个磁道（track）有几个扇区（必须是18）
    21 00007C1A 0002                                DW  2                               ;磁头数（必须是2)
    22 00007C1C 00000000                            DD  0                               ;不适用分区，必须是0
    23 00007C20 00000B40                            DD  2880                            ;重写一次磁盘大小
    24 00007C24 00 00 29                            DB  0,0,0X29                        ;意义不明固定
    25 00007C27 FFFFFFFF                            DD  0XFFFFFFFF                      ;可能是卷标号
    26 00007C2B 48 45 4C 4C 4F 2D 4F 53 20 20       DB  "HELLO-OS   "                   ;磁盘的名称（11字节）
       00007C35 20 
    27 00007C36 46 41 54 31 32 20 20 20             DB  "FAT12   "                      ;磁盘格式名称（8字节）
    28 00007C3E 00 00 00 00 00 00 00 00 00 00       RESB    18                           ;
       00007C48 00 00 00 00 00 00 00 00 
    29 00007C50                                 
    30 00007C50                                 ;-----------------------START -- 清屏------------------
    31 00007C50 B4 0F                                   MOV     AH, 15                 ;显示一个文字
    32 00007C52 CD 10                                   INT     0X10                    ;调用显卡BIOS
    33 00007C54 B4 00                                   MOV     AH, 0                 ;显示一个文字
    34 00007C56 CD 10                                   INT     0X10                    ;调用显卡BIOS
    35 00007C58                                 
    36 00007C58                                 ;-----------------------END -- 清屏------------------
    37 00007C58                                 
    38 00007C58                                 
    39 00007C58                                 entry:
    40 00007C58 B8 0000                                 MOV     AX, 0
    41 00007C5B 8E D0                                   MOV     SS, AX
    42 00007C5D BC 7C00                                 MOV     SP, 0X7C00
    43 00007C60 8E D8                                   MOV     DS,AX
    44 00007C62 8E C0                                   MOV     ES,AX
    45 00007C64                                 
    46 00007C64 B8 0820                                 MOV     AX, 0x0820
    47 00007C67 8E C0                                   MOV     ES,AX
    48 00007C69 B5 00                                   MOV     CH,0                    ;柱面0
    49 00007C6B B6 00                                   MOV     DH,0                    ;磁头0
    50 00007C6D B1 02                                   MOV     CL,2                    ;扇区2
    51 00007C6F                                 readloop:
    52 00007C6F BE 0000                                 MOV     SI,0                    ;记录失败次数的寄存器
    53 00007C72                                 retry:
    54 00007C72 B4 02                                   MOV     AH,0X02                 ;读盘
    55 00007C74 B0 01                                   MOV     AL,1                    ;1个扇区
    56 00007C76 BB 0000                                 MOV     BX,0                    ;
    57 00007C79 B2 00                                   MOV     DL,0X00                 ;A驱动器
    58 00007C7B CD 13                                   INT     0X13                    ;调用磁盘BIOS
    59 00007C7D                                 ;-----------------------START -- 显示读取的扇区，磁头和柱面------------------
    60 00007C7D B0 20                                   MOV     AL,' '
    61 00007C7F B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    62 00007C81 BB 000F                                 MOV     BX,15                   ;指定字符颜色
    63 00007C84 CD 10                                   INT     0X10                    ;调用显卡BIOS
    64 00007C86 B0 30                                   MOV     AL,'0'
    65 00007C88 00 C8                                   ADD     AL, CL
    66 00007C8A B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    67 00007C8C BB 000F                                 MOV     BX,15                   ;指定字符颜色
    68 00007C8F CD 10                                   INT     0X10                    ;调用显卡BIOS
    69 00007C91 B0 30                                   MOV     AL,'0'
    70 00007C93 00 F0                                   ADD     AL, DH
    71 00007C95 B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    72 00007C97 BB 000F                                 MOV     BX,15                   ;指定字符颜色
    73 00007C9A CD 10                                   INT     0X10                    ;调用显卡BIOS
    74 00007C9C B0 30                                   MOV     AL,'0'
    75 00007C9E 00 E8                                   ADD     AL, CH
    76 00007CA0 B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    77 00007CA2 BB 000F                                 MOV     BX,15                   ;指定字符颜色
    78 00007CA5 CD 10                                   INT     0X10                    ;调用显卡BIOS
    79 00007CA7                                 ;-----------------------END -- 显示读取的扇区，磁头和柱面------------------
    80 00007CA7 73 10                                   JNC     next
    81 00007CA9 83 C6 01                                ADD     SI,1
    82 00007CAC 83 FE 05                                CMP     SI,5
    83 00007CAF 73 4A                                   JAE     error
    84 00007CB1 B4 00                                   MOV     AH,0X00
    85 00007CB3 B2 00                                   MOV     DL,0X00
    86 00007CB5 CD 13                                   INT     0X13
    87 00007CB7 EB B9                                   JMP     retry
    88 00007CB9                                 next:
    89 00007CB9                                 ;-------------读到18 扇区------------------------------------
    90 00007CB9 8C C0                                   MOV     AX,ES
    91 00007CBB 05 0020                                 ADD     AX,0X0020
    92 00007CBE 8E C0                                   MOV     ES,AX
    93 00007CC0 80 C1 01                                ADD     CL,1                    ;扇区加1
    94 00007CC3 80 F9 12                                CMP     CL,18                   ;只到扇区18
    95 00007CC6 76 A7                                   JBE     readloop
    96 00007CC8                                 ;------------读 磁头2 -----------------------------------------
    97 00007CC8 8C C0                                   MOV     AX,ES
    98 00007CCA 05 0020                                 ADD     AX,0X0020
    99 00007CCD 8E C0                                   MOV     ES,AX
   100 00007CCF B1 01                                   MOV     CL, 1                   ;重新回到扇区1
   101 00007CD1 80 C6 01                                ADD     DH, 1                   ;磁头加1
   102 00007CD4                                 
   103 00007CD4 80 FE 01                                CMP     DH, 1
   104 00007CD7 76 96                                   JBE     readloop
   105 00007CD9                                 ;------------读到柱面 10 ---------------------------------------
   106 00007CD9 8C C0                                   MOV     AX,ES
   107 00007CDB 05 0020                                 ADD     AX,0X0020
   108 00007CDE 8E C0                                   MOV     ES,AX
   109 00007CE0 B1 01                                   MOV     CL, 1                   ;重新回到扇区1
   110 00007CE2 B6 00                                   MOV     DH, 0                   ;磁头加1
   111 00007CE4 80 C5 01                                ADD     CH, 1
   112 00007CE7 80 FD 09                                CMP     CH, 9
   113 00007CEA 76 83                                   JBE     readloop
   114 00007CEC                                 
   115 00007CEC                                 
   116 00007CEC                                         
   117 00007CEC                                  success:                                       ;successful
   118 00007CEC BE 7D3F                                 MOV     SI, succmsg
   119 00007CEF EB 0D                                   JMP     putloop
   120 00007CF1                                 
   121 00007CF1                                 fin:
   122 00007CF1 88 2E 0FF0                       	MOV	[0x0ff0],CH		; IPL���ǂ��܂œǂ񂾂̂�������
   123 00007CF5 E9 4508                         	JMP	0xc200
   124 00007CF8 F4                                      HLT
   125 00007CF9 EB F6                                   JMP     fin
   126 00007CFB                                 
   127 00007CFB                                 error:
   128 00007CFB BE 7D10                                 MOV     SI, errormsg
   129 00007CFE                                 putloop:
   130 00007CFE 8A 04                                   MOV     AL,[SI]
   131 00007D00 83 C6 01                                ADD     SI,1
   132 00007D03 3C 00                                   CMP     AL,0
   133 00007D05                                 
   134 00007D05 74 EA                                   JE      fin
   135 00007D07 B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
   136 00007D09 BB 000F                                 MOV     BX,15                   ;指定字符颜色
   137 00007D0C CD 10                                   INT     0X10                    ;调用显卡BIOS
   138 00007D0E EB EE                                   JMP     putloop
   139 00007D10                                 
   140 00007D10                                 
   141 00007D10                                 
   142 00007D10                                 errormsg:
   143 00007D10 0A 0D                                   DB  0X0A,0X0D
   144 00007D12 4C 4F 41 44 20 45 52 52 4F 52           DB  "LOAD ERROR -- HELLO, Lucky, DON'T GIVE UP"
       00007D1C 20 2D 2D 20 48 45 4C 4C 4F 2C 
       00007D26 20 4C 75 63 6B 79 2C 20 44 4F 
       00007D30 4E 27 54 20 47 49 56 45 20 55 
       00007D3A 50 
   145 00007D3B 07 07                                   DB  0x07, 0x07
   146 00007D3D 0A                                      DB  0X0A
   147 00007D3E 00                                      DB  0
   148 00007D3F                                 
   149 00007D3F                                 succmsg:
   150 00007D3F 0A 0D                                   DB  0X0A,0X0D
   151 00007D41 4C 4F 41 44 20 53 75 63 63 65           DB  "LOAD Success -- HELLO, Lucky, DON'T GIVE UP"
       00007D4B 73 73 20 2D 2D 20 48 45 4C 4C 
       00007D55 4F 2C 20 4C 75 63 6B 79 2C 20 
       00007D5F 44 4F 4E 27 54 20 47 49 56 45 
       00007D69 20 55 50 
   152 00007D6C 07 07                                   DB  0x07, 0x07
   153 00007D6E 0A                                      DB  0X0A
   154 00007D6F 00                                      DB  0
   155 00007D70                                 
   156 00007D70 00 00 00 00 00 00 00 00 00 00   	RESB	0x7dfe-$
       00007D7A 00 00 00 00 00 00 00 00 00 00 
       00007D84 00 00 00 00 00 00 00 00 00 00 
       00007D8E 00 00 00 00 00 00 00 00 00 00 
       00007D98 00 00 00 00 00 00 00 00 00 00 
       00007DA2 00 00 00 00 00 00 00 00 00 00 
       00007DAC 00 00 00 00 00 00 00 00 00 00 
       00007DB6 00 00 00 00 00 00 00 00 00 00 
       00007DC0 00 00 00 00 00 00 00 00 00 00 
       00007DCA 00 00 00 00 00 00 00 00 00 00 
       00007DD4 00 00 00 00 00 00 00 00 00 00 
       00007DDE 00 00 00 00 00 00 00 00 00 00 
       00007DE8 00 00 00 00 00 00 00 00 00 00 
       00007DF2 00 00 00 00 00 00 00 00 00 00 
       00007DFC 00 00 
   157 00007DFE 55 AA                                   DB	0x55, 0xaa