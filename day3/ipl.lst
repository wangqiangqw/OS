     1 00000000                                 ;hello-os
     2 00000000                                 ;TAB=4
     3                                              ORG 0x7c00
     4 00007C00                                 
     5 00007C00 EB 4E                               JMP entry
     6 00007C02 90                                  DB  0x90
     7 00007C03                                 
     8 00007C03 48 41 52 49 42 4F 54 45             DB  "HARIBOTE"                      ;启动区的名称可以是任意的字符串（8字节）
     9 00007C0B 0200                                DW  512                             ;每个扇区（sector）的大小（必须为512字节）
    10 00007C0D 01                                  DB  1                               ;簇（cluster）的大小（必须为1个扇区）
    11 00007C0E 0001                                DW  1                               ;FAT的起始位置（一般从第一个扇区开始）
    12 00007C10 02                                  DB  2                               ;FAT的个数（必须为2）
    13 00007C11 00E0                                DW  224                             ;根目录的大小（一般设成224项）
    14 00007C13 0B40                                DW  2880                            ;该磁盘的大小（必须是2880扇区）
    15 00007C15 F0                                  DB  0XF0                            ;磁盘的种类（必须是0XF0）
    16 00007C16 0009                                DW  9                               ;FAT的长度（必须是9扇区）
    17 00007C18 0012                                DW  18                              ;1个磁道（track）有几个扇区（必须是18）
    18 00007C1A 0002                                DW  2                               ;磁头数（必须是2)
    19 00007C1C 00000000                            DD  0                               ;不适用分区，必须是0
    20 00007C20 00000B40                            DD  2880                            ;重写一次磁盘大小
    21 00007C24 00 00 29                            DB  0,0,0X29                        ;意义不明固定
    22 00007C27 FFFFFFFF                            DD  0XFFFFFFFF                      ;可能是卷标号
    23 00007C2B 48 45 4C 4C 4F 2D 4F 53 20 20       DB  "HELLO-OS   "                   ;磁盘的名称（11字节）
       00007C35 20 
    24 00007C36 46 41 54 31 32 20 20 20             DB  "FAT12   "                      ;磁盘格式名称（8字节）
    25 00007C3E 00 00 00 00 00 00 00 00 00 00       RESB    18                           ;
       00007C48 00 00 00 00 00 00 00 00 
    26 00007C50                                 
    27 00007C50                                 entry:
    28 00007C50 B8 0000                                 MOV     AX, 0
    29 00007C53 8E D0                                   MOV     SS, AX
    30 00007C55 BC 7C00                                 MOV     SP, 0X7C00
    31 00007C58 8E D8                                   MOV     DS,AX
    32 00007C5A 8E C0                                   MOV     ES,AX
    33 00007C5C                                 
    34 00007C5C B8 0820                                 MOV     AX, 0x0820
    35 00007C5F 8E C0                                   MOV     ES,AX
    36 00007C61 B5 00                                   MOV     CH,0                    ;柱面0
    37 00007C63 B6 00                                   MOV     DH,0                    ;磁头0
    38 00007C65 B1 02                                   MOV     CL,2                    ;扇区2
    39 00007C67                                 readloop:
    40 00007C67 BE 0000                                 MOV     SI,0                    ;记录失败次数的寄存器
    41 00007C6A                                 retry:
    42 00007C6A B4 02                                   MOV     AH,0X02                 ;读盘
    43 00007C6C B0 01                                   MOV     AL,1                    ;1个扇区
    44 00007C6E BB 0000                                 MOV     BX,0                    ;
    45 00007C71 B2 00                                   MOV     DL,0X00                 ;A驱动器
    46 00007C73 CD 13                                   INT     0X13                    ;调用磁盘BIOS
    47 00007C75                                 ;-----------------------显示读取的扇区，磁头和柱面------------------
    48 00007C75 B0 20                                   MOV     AL,' '
    49 00007C77 B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    50 00007C79 BB 000F                                 MOV     BX,15                   ;指定字符颜色
    51 00007C7C CD 10                                   INT     0X10                    ;调用显卡BIOS
    52 00007C7E B0 30                                   MOV     AL,'0'
    53 00007C80 00 C8                                   ADD     AL, CL
    54 00007C82 B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    55 00007C84 BB 000F                                 MOV     BX,15                   ;指定字符颜色
    56 00007C87 CD 10                                   INT     0X10                    ;调用显卡BIOS
    57 00007C89 B0 30                                   MOV     AL,'0'
    58 00007C8B 00 F0                                   ADD     AL, DH
    59 00007C8D B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    60 00007C8F BB 000F                                 MOV     BX,15                   ;指定字符颜色
    61 00007C92 CD 10                                   INT     0X10                    ;调用显卡BIOS
    62 00007C94 B0 30                                  MOV     AL,'0'
    63 00007C96 00 E8                                   ADD     AL, CH
    64 00007C98 B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
    65 00007C9A BB 000F                                 MOV     BX,15                   ;指定字符颜色
    66 00007C9D CD 10                                   INT     0X10                    ;调用显卡BIOS
    67 00007C9F                                 ;-----------------------显示读取的扇区，磁头和柱面------------------
    68 00007C9F 73 10                                   JNC     next
    69 00007CA1 83 C6 01                                ADD     SI,1
    70 00007CA4 83 FE 05                                CMP     SI,5
    71 00007CA7 73 43                                   JAE     error
    72 00007CA9 B4 00                                   MOV     AH,0X00
    73 00007CAB B2 00                                   MOV     DL,0X00
    74 00007CAD CD 13                                   INT     0X13
    75 00007CAF EB B9                                   JMP     retry
    76 00007CB1                                 next:
    77 00007CB1                                 ;-------------读到18 扇区------------------------------------
    78 00007CB1 8C C0                                   MOV     AX,ES
    79 00007CB3 05 0020                                 ADD     AX,0X0020
    80 00007CB6 8E C0                                   MOV     ES,AX
    81 00007CB8 80 C1 01                                ADD     CL,1                    ;扇区加1
    82 00007CBB 80 F9 12                                CMP     CL,18                   ;只到扇区18
    83 00007CBE 76 A7                                   JBE     readloop
    84 00007CC0                                 ;------------读 磁头2 -----------------------------------------
    85 00007CC0 8C C0                                   MOV     AX,ES
    86 00007CC2 05 0020                                 ADD     AX,0X0020
    87 00007CC5 8E C0                                   MOV     ES,AX
    88 00007CC7 B1 01                                   MOV     CL, 1                   ;重新回到扇区1
    89 00007CC9 80 C6 01                                ADD     DH, 1                   ;磁头加1
    90 00007CCC                                 
    91 00007CCC 80 FE 01                                CMP     DH, 1
    92 00007CCF 76 96                                   JBE     readloop
    93 00007CD1                                 ;------------读到柱面 10 ---------------------------------------
    94 00007CD1 8C C0                                   MOV     AX,ES
    95 00007CD3 05 0020                                 ADD     AX,0X0020
    96 00007CD6 8E C0                                   MOV     ES,AX
    97 00007CD8 B1 01                                   MOV     CL, 1                   ;重新回到扇区1
    98 00007CDA B6 00                                   MOV     DH, 0                   ;磁头加1
    99 00007CDC 80 C5 01                                ADD     CH, 1
   100 00007CDF 80 FD 09                                CMP     CH, 9
   101 00007CE2 76 83                                   JBE     readloop
   102 00007CE4                                 
   103 00007CE4                                 
   104 00007CE4                                         
   105 00007CE4                                  success:                                       ;successful
   106 00007CE4 BE 7D30                                 MOV     SI, succmsg
   107 00007CE7 EB 06                                   JMP     putloop
   108 00007CE9                                 fin:
   109 00007CE9 F4                                      HLT
   110 00007CEA EB FD                                   JMP     fin
   111 00007CEC                                 
   112 00007CEC                                 error:
   113 00007CEC BE 7D01                                 MOV     SI, errormsg
   114 00007CEF                                 putloop:
   115 00007CEF 8A 04                                   MOV     AL,[SI]
   116 00007CF1 83 C6 01                                ADD     SI,1
   117 00007CF4 3C 00                                   CMP     AL,0
   118 00007CF6                                 
   119 00007CF6 74 F1                                   JE      fin
   120 00007CF8 B4 0E                                   MOV     AH,0X0E                 ;显示一个文字
   121 00007CFA BB 000F                                 MOV     BX,15                   ;指定字符颜色
   122 00007CFD CD 10                                   INT     0X10                    ;调用显卡BIOS
   123 00007CFF EB EE                                   JMP     putloop
   124 00007D01                                 
   125 00007D01                                 
   126 00007D01                                 
   127 00007D01                                 errormsg:
   128 00007D01 0A 0D                                   DB  0X0A,0X0D
   129 00007D03 4C 4F 41 44 20 45 52 52 4F 52           DB  "LOAD ERROR -- HELLO, Lucky, DON'T GIVE UP"
       00007D0D 20 2D 2D 20 48 45 4C 4C 4F 2C 
       00007D17 20 4C 75 63 6B 79 2C 20 44 4F 
       00007D21 4E 27 54 20 47 49 56 45 20 55 
       00007D2B 50 
   130 00007D2C 07 07                                   DB  0x07, 0x07
   131 00007D2E 0A                                      DB  0X0A
   132 00007D2F 00                                      DB  0
   133 00007D30                                 
   134 00007D30                                 succmsg:
   135 00007D30 0A 0D                                   DB  0X0A,0X0D
   136 00007D32 4C 4F 41 44 20 53 75 63 63 65           DB  "LOAD Success -- HELLO, Lucky, DON'T GIVE UP"
       00007D3C 73 73 20 2D 2D 20 48 45 4C 4C 
       00007D46 4F 2C 20 4C 75 63 6B 79 2C 20 
       00007D50 44 4F 4E 27 54 20 47 49 56 45 
       00007D5A 20 55 50 
   137 00007D5D 07 07                                   DB  0x07, 0x07
   138 00007D5F 0A                                      DB  0X0A
   139 00007D60 00                                      DB  0
   140 00007D61                                 
   141 00007D61 00 00 00 00 00 00 00 00 00 00   	RESB	0x7dfe-$
       00007D6B 00 00 00 00 00 00 00 00 00 00 
       00007D75 00 00 00 00 00 00 00 00 00 00 
       00007D7F 00 00 00 00 00 00 00 00 00 00 
       00007D89 00 00 00 00 00 00 00 00 00 00 
       00007D93 00 00 00 00 00 00 00 00 00 00 
       00007D9D 00 00 00 00 00 00 00 00 00 00 
       00007DA7 00 00 00 00 00 00 00 00 00 00 
       00007DB1 00 00 00 00 00 00 00 00 00 00 
       00007DBB 00 00 00 00 00 00 00 00 00 00 
       00007DC5 00 00 00 00 00 00 00 00 00 00 
       00007DCF 00 00 00 00 00 00 00 00 00 00 
       00007DD9 00 00 00 00 00 00 00 00 00 00 
       00007DE3 00 00 00 00 00 00 00 00 00 00 
       00007DED 00 00 00 00 00 00 00 00 00 00 
       00007DF7 00 00 00 00 00 00 00 
   142 00007DFE 55 AA                                   DB	0x55, 0xaa